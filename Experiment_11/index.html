<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student Search (AJAX)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">

<div class="container" style="max-width:700px;">
  <div class="card shadow-sm p-4">
    <h3 class="mb-3 text-center">Search Student Records</h3>

    <div class="input-group mb-3">
      <input id="searchInput" type="text" class="form-control" placeholder="Enter student name">
      <button id="btnSearch" class="btn btn-success">Search</button>
    </div>

    <div id="results" class="mt-2"></div>
  </div>
</div>

<script>
const btn = document.getElementById('btnSearch');
const input = document.getElementById('searchInput');
const results = document.getElementById('results');

async function searchStudents() {
  const q = input.value.trim();
  results.innerHTML = '<div class="text-muted">Searchingâ€¦</div>';

  try {
    const res = await fetch('search.php?query=' + encodeURIComponent(q));
    if (!res.ok) throw new Error('Server error');
    const students = await res.json();

    if (!Array.isArray(students) || students.length === 0) {
      results.innerHTML = '<div class="alert alert-warning mb-0">No students found.</div>';
      return;
    }

    // build table
    let html = `<div class="table-responsive"><table class="table table-sm table-striped mb-0">
      <thead class="table-light"><tr><th>Name</th><th>Age</th><th>Grade</th></tr></thead><tbody>`;
    students.forEach(s => {
      html += `<tr><td>${escapeHtml(s.name)}</td><td>${escapeHtml(s.age)}</td><td>${escapeHtml(s.grade)}</td></tr>`;
    });
    html += `</tbody></table></div>`;
    results.innerHTML = html;

  } catch (err) {
    results.innerHTML = `<div class="alert alert-danger mb-0">Error: ${escapeHtml(err.message)}</div>`;
  }
}

// small helper to avoid injecting raw HTML
function escapeHtml(str) {
  return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;');
}

btn.addEventListener('click', searchStudents);
input.addEventListener('keydown', e => { if (e.key === 'Enter') searchStudents(); });
</script>

</body>
</html>
